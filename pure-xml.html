

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Pure-XML - XML/XSLT interface &mdash; Pure Language and Library Documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="top" title="Pure Language and Library Documentation" href="index.html" />
    <link rel="next" title="pure-g2" href="pure-g2.html" />
    <link rel="prev" title="Pure-Sql3" href="pure-sql3.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="pure-g2.html" title="pure-g2"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pure-sql3.html" title="Pure-Sql3"
             accesskey="P">previous</a> |</li>
        <li><a href="puredoc.html">Pure Language and Library Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="pure-xml-xml-xslt-interface">
<h1>Pure-XML - XML/XSLT interface<a class="headerlink" href="#pure-xml-xml-xslt-interface" title="Permalink to this headline">¶</a></h1>
<p>Albert Graef &lt;<a class="reference external" href="mailto:Dr&#46;Graef&#37;&#52;&#48;t-online&#46;de">Dr<span>&#46;</span>Graef<span>&#64;</span>t-online<span>&#46;</span>de</a>&gt;</p>
<p><a class="reference external" href="http://www.w3.org/TR/xml">XML</a>, the Extensible Markup Language, facilitates the exchange of complex
structured data between applications and systems. <a class="reference external" href="http://www.w3.org/TR/xslt">XSLT</a> allows you to
transform XML documents to other XML-based formats such as HTML. Together, XML
and XSLT let you create dynamic web content with ease. Both XML and XSLT are
open standards by the W3C consortium (<a class="reference external" href="http://www.w3.org">http://www.w3.org</a>).</p>
<p>Pure&#8217;s XML interface is based on the libxml2 and libxslt libraries from the
GNOME project. If you have a Linux system then you most likely have these
libraries, otherwise you can get them from <a class="reference external" href="http://xmlsoft.org">http://xmlsoft.org</a>. For Windows
users, the required dlls are available from the GnuWin32 project
(<a class="reference external" href="http://gnuwin32.sourceforge.net">http://gnuwin32.sourceforge.net</a>) and are already included in the Pure MSI
package.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#copying" id="id2">Copying</a></li>
<li><a class="reference internal" href="#installation" id="id3">Installation</a></li>
<li><a class="reference internal" href="#usage" id="id4">Usage</a></li>
<li><a class="reference internal" href="#data-structure" id="id5">Data Structure</a><ul>
<li><a class="reference internal" href="#the-document-tree" id="id6">The Document Tree</a></li>
<li><a class="reference internal" href="#document-types" id="id7">Document Types</a></li>
</ul>
</li>
<li><a class="reference internal" href="#operations" id="id8">Operations</a><ul>
<li><a class="reference internal" href="#document-operations" id="id9">Document Operations</a></li>
<li><a class="reference internal" href="#traversing-documents" id="id10">Traversing Documents</a></li>
<li><a class="reference internal" href="#node-information" id="id11">Node Information</a></li>
<li><a class="reference internal" href="#node-manipulation" id="id12">Node Manipulation</a></li>
<li><a class="reference internal" href="#transformations" id="id13">Transformations</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="copying">
<h2><a class="toc-backref" href="#id2">Copying</a><a class="headerlink" href="#copying" title="Permalink to this headline">¶</a></h2>
<p>Copyright (c) 2009 by Albert Graef &lt;<a class="reference external" href="mailto:Dr&#46;Graef&#37;&#52;&#48;t-online&#46;de">Dr<span>&#46;</span>Graef<span>&#64;</span>t-online<span>&#46;</span>de</a>&gt;.</p>
<p>pure-xml is free software: you can redistribute it and/or modify it under the
terms of the GNU Lesser General Public License as published by the Free
Software Foundation, either version 3 of the License, or (at your option) any
later version.</p>
<p>pure-xml is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
A PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more
details.</p>
<p>You should have received a copy of the GNU Lesser General Public License along
with this program.  If not, see &lt;<a class="reference external" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.</p>
</div>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id3">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Run <tt class="docutils literal"><span class="pre">make</span></tt> and then <tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">make</span> <span class="pre">install</span></tt> to compile and install this module
from source. This requires libxml2, libxslt and Pure.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id4">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Use the following declaration to make the operations of this module available
in your programs:</p>
<div class="highlight-python"><pre>using xml;</pre>
</div>
<p>The module defines two namespaces <tt class="docutils literal"><span class="pre">xml</span></tt> and <tt class="docutils literal"><span class="pre">xslt</span></tt> for the XML and the
XSLT operations, respectively. For convenience, you can open these in your
program as follows:</p>
<div class="highlight-python"><pre>using namespace xml, xslt;</pre>
</div>
<p>A number of complete examples illustrating the use of this module can be found
in the examples directory in the source distribution.</p>
</div>
<div class="section" id="data-structure">
<h2><a class="toc-backref" href="#id5">Data Structure</a><a class="headerlink" href="#data-structure" title="Permalink to this headline">¶</a></h2>
<p>This module represents XML documents using pointers to the <tt class="docutils literal"><span class="pre">xmlDoc</span></tt> and
<tt class="docutils literal"><span class="pre">xmlNode</span></tt> structures provided by the libxml2 library. Similarly,
stylesheets are simply pointers to the xmlStylesheet structure from libxslt
(cf. <a class="reference internal" href="#transformations">Transformations</a>). This makes it possible to use these objects
directly with the operations of the libxml2 and libsxslt libraries (via
Pure&#8217;s C interface) if necessary. Note, however, that these are all
&#8220;cooked&#8221; pointers which take care of freeing themselves automatically when
they are no longer needed, therefore you shouldn&#8217;t free them manually.</p>
<p>You can also check for these types of pointers using the following
predicates:</p>
<ul class="simple" id="docp">
<span id="index-0"></span><li><tt class="docutils literal"><span class="pre">xml::docp</span> <span class="pre">x</span></tt> checks whether <tt class="docutils literal"><span class="pre">x</span></tt> is an XML document pointer.</li>
</ul>
<ul class="simple" id="nodep">
<span id="index-1"></span><li><tt class="docutils literal"><span class="pre">xml::nodep</span> <span class="pre">x</span></tt> checks whether <tt class="docutils literal"><span class="pre">x</span></tt> is a pointer to a node in an XML
document.</li>
</ul>
<ul class="simple" id="stylesheetp">
<span id="index-2"></span><li><tt class="docutils literal"><span class="pre">xslt::stylesheetp</span> <span class="pre">x</span></tt> checks whether <tt class="docutils literal"><span class="pre">x</span></tt> is an XSLT stylesheet
pointer.</li>
</ul>
<div class="section" id="the-document-tree">
<h3><a class="toc-backref" href="#id6">The Document Tree</a><a class="headerlink" href="#the-document-tree" title="Permalink to this headline">¶</a></h3>
<p>An XML document is a rooted tree which can be created, traversed and
manipulated using the operations of this module. There are different types
of nodes in the tree, each carrying their own type of data. In Pure land,
the node data is described using the following &#8220;node info&#8221; constructors.</p>
<ul id="node-info">
<span id="index-3"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::element</span> <span class="pre">tag</span> <span class="pre">ns</span> <span class="pre">attrs</span></tt></p>
<p>An XML element with given (possibly qualified) name <tt class="docutils literal"><span class="pre">tag</span></tt>, a (possibly
empty) list of namespace declarations <tt class="docutils literal"><span class="pre">ns</span></tt> and a (possibly empty) list
of attributes <tt class="docutils literal"><span class="pre">attrs</span></tt>. Namespace declarations normally take the form of
a pair of strings <tt class="docutils literal"><span class="pre">(prefix,href)</span></tt>, where <tt class="docutils literal"><span class="pre">prefix</span></tt> is the prefix
associated with the namespace and <tt class="docutils literal"><span class="pre">href</span></tt> the corresponding URI (the
name of the namespace), but they can also be just a string <tt class="docutils literal"><span class="pre">href</span></tt> if
the namespace prefix is missing. Attributes are encoded as <tt class="docutils literal"><span class="pre">key=&gt;value</span></tt>
pairs, where <tt class="docutils literal"><span class="pre">key</span></tt> is the attribute name and <tt class="docutils literal"><span class="pre">value</span></tt> the associated
value; both <tt class="docutils literal"><span class="pre">key</span></tt> and <tt class="docutils literal"><span class="pre">value</span></tt> are strings.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::element_text</span> <span class="pre">tag</span> <span class="pre">ns</span> <span class="pre">attrs</span> <span class="pre">content</span></tt></p>
<p>A convenience function which denotes a combination of an element node
with a text child. This is only used when creating a new node, and
indicates that a text node child is to be added to the node
automatically.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::attr</span> <span class="pre">key</span> <span class="pre">val</span></tt></p>
<p>An attribute node. These only occur as results of the <a class="reference internal" href="#select">select</a> and <a class="reference internal" href="#attrs">attrs</a>
functions, and cannot be inserted directly into a document.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::text</span> <span class="pre">content</span></tt></p>
<p>A text node with the given content (a string).</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::cdata</span> <span class="pre">content</span></tt></p>
<p>Like <tt class="docutils literal"><span class="pre">xml::text</span></tt>, but contains unparsed character data.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::comment</span> <span class="pre">content</span></tt></p>
<p>A comment.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::entity_ref</span> <span class="pre">name</span></tt></p>
<p>An entity reference (<tt class="docutils literal"><span class="pre">&amp;name;</span></tt>).</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::pi</span> <span class="pre">name</span> <span class="pre">content</span></tt></p>
<p>Processing instructions. <tt class="docutils literal"><span class="pre">name</span></tt> is the application name, <tt class="docutils literal"><span class="pre">content</span></tt>
the text of the processing instructions.</p>
</li>
</ul>
</div>
<div class="section" id="document-types">
<h3><a class="toc-backref" href="#id7">Document Types</a><a class="headerlink" href="#document-types" title="Permalink to this headline">¶</a></h3>
<p id="dtd"><span id="index-4"></span>Besides the node types described above, there are some additional node
types used in the <a class="reference external" href="http://www.w3.org/TR/REC-xml/#dt-doctype">document type definition</a> (DTD), which can be extracted
from a document using the <a class="reference internal" href="#int-subset">int_subset</a> and <a class="reference internal" href="#ext-subset">ext_subset</a> functions. These are
for inspection purposes only; it is not possible to change the DTD of a
document in-place. (However, you can create a new document and attach a DTD
to it, using the <a class="reference internal" href="#new-doc">new_doc</a> function.)</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::doctype</span> <span class="pre">name</span> <span class="pre">extid</span></tt></p>
<p>DTDs are represented using this special type of node, where <tt class="docutils literal"><span class="pre">name</span></tt> is
the name of the root element, and <tt class="docutils literal"><span class="pre">extid</span></tt> is a pair consisting of the
external identifier and the URI of the DTD (or just the URI if there is
no external identifier). The <tt class="docutils literal"><span class="pre">xml::doctype</span></tt> node has as its children
zero or more of the following kinds of DTD declaration nodes (these are
just straightforward abstract syntax for the !ELEMENT, !ATTLIST and
!ENTITY declarations inside a DTD declaration; see the XML specification
for details).</p>
</li>
</ul>
<p id="element-declaration"><span id="index-5"></span><em>Element declarations:</em> Here, <tt class="docutils literal"><span class="pre">name</span></tt> is the element tag and <tt class="docutils literal"><span class="pre">content</span></tt>
the definition of the element structure, see <a class="reference internal" href="#element-content">element content</a> below. XML
supports various kinds of element types, please refer to <a class="reference external" href="http://www.w3.org/TR/REC-xml/#dt-doctype">document type
definition</a> in the XML specification for details.</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::undefined_element</span> <span class="pre">name</span></tt></p>
<p>An undefined element. This is in libxml2, but not in the XML
specification, you shouldn&#8217;t see this in normal operation.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::empty_element</span> <span class="pre">name</span></tt></p>
<p>An element without any content.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::any_element</span> <span class="pre">name</span></tt></p>
<p>An element with unrestricted content.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::mixed_element</span> <span class="pre">name</span> <span class="pre">content</span></tt></p>
<p>A &#8220;mixed&#8221; element which can contain character data, optionally
interspersed with child elements, as given in the <tt class="docutils literal"><span class="pre">content</span></tt>
specification.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xml::std_element</span> <span class="pre">name</span> <span class="pre">content</span></tt></p>
<p>A standard element consisting <em>only</em> of child elements, as given in the
<tt class="docutils literal"><span class="pre">content</span></tt> specification.</p>
</li>
</ul>
<p id="attribute-declaration"><span id="index-6"></span><em>Attribute declarations:</em> These are used to declare the attributes of an
element. <tt class="docutils literal"><span class="pre">elem_name</span></tt> is the name of an element which describes the
attribute type, <tt class="docutils literal"><span class="pre">name</span></tt> is the name of the attribute itself, and
<tt class="docutils literal"><span class="pre">default</span></tt> specifies the default value of the attribute, see <a class="reference internal" href="#attribute-defaults">attribute
defaults</a> below. XML supports a bunch of different attribute types, please
refer to <a class="reference external" href="http://www.w3.org/TR/REC-xml/#dt-doctype">document type definition</a> in the XML specification for details.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">xml::cdata_attr</span> <span class="pre">elem_name</span> <span class="pre">name</span> <span class="pre">default</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::id_attr</span> <span class="pre">elem_name</span> <span class="pre">name</span> <span class="pre">default</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::idref_attr</span> <span class="pre">elem_name</span> <span class="pre">name</span> <span class="pre">default</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::idrefs_attr</span> <span class="pre">elem_name</span> <span class="pre">name</span> <span class="pre">default</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::entity_attr</span> <span class="pre">elem_name</span> <span class="pre">name</span> <span class="pre">default</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::entities_attr</span> <span class="pre">elem_name</span> <span class="pre">name</span> <span class="pre">default</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::nmtoken_attr</span> <span class="pre">elem_name</span> <span class="pre">name</span> <span class="pre">default</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::nmtokens_attr</span> <span class="pre">elem_name</span> <span class="pre">name</span> <span class="pre">default</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::enum_attr</span> <span class="pre">elem_name</span> <span class="pre">name</span> <span class="pre">vals</span> <span class="pre">default</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::notation_attr</span> <span class="pre">elem_name</span> <span class="pre">name</span> <span class="pre">vals</span> <span class="pre">default</span></tt></li>
</ul>
<p id="entity-declaration"><span id="index-7"></span><em>Entity declarations:</em> These are used for internal and external entity
declarations. <tt class="docutils literal"><span class="pre">name</span></tt> is the entity name and <tt class="docutils literal"><span class="pre">content</span></tt> its
definition. External entities also have an <tt class="docutils literal"><span class="pre">extid</span></tt> (external
identifier/URI pair) identifying the entity.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">xml::int_entity</span> <span class="pre">name</span> <span class="pre">content</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::int_param_entity</span> <span class="pre">name</span> <span class="pre">content</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::ext_entity</span> <span class="pre">name</span> <span class="pre">extid</span> <span class="pre">content</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::ext_param_entity</span> <span class="pre">name</span> <span class="pre">extid</span> <span class="pre">content</span></tt></li>
</ul>
<p id="element-content"><span id="index-8"></span>The element content type (<tt class="docutils literal"><span class="pre">content</span></tt> argument of the <a class="reference internal" href="#element-declaration">element
declaration</a> nodes) is a kind of regular expression formed with tags
(specified as strings) and the following constructors:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">xml::pcdata</span></tt>: text data (<tt class="docutils literal"><span class="pre">#PCDATA</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">xml::sequence</span> <span class="pre">xs</span></tt>: concatenation (<tt class="docutils literal"><span class="pre">x,y,z</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">xml::union</span> <span class="pre">xs</span></tt>: alternatives (<tt class="docutils literal"><span class="pre">x|y|z</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">xml::opt</span> <span class="pre">x</span></tt>: optional element (<tt class="docutils literal"><span class="pre">x?</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">xml::mult</span> <span class="pre">x</span></tt>: repeated element (<tt class="docutils literal"><span class="pre">x*</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">xml::plus</span> <span class="pre">x</span></tt>: non-optional repeated element (<tt class="docutils literal"><span class="pre">x+</span></tt>)</li>
</ul>
<p id="attribute-defaults"><span id="index-9"></span>Attribute defaults (the <tt class="docutils literal"><span class="pre">default</span></tt> argument of <a class="reference internal" href="#attribute-declaration">attribute declaration</a>
nodes) are represented using the following constructor symbols:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">xml::required</span></tt>: a required attribute, i.e., the user must specify this</li>
<li><tt class="docutils literal"><span class="pre">xml::implied</span></tt>: an implied attribute, i.e., the user does not have to
specify this</li>
<li><tt class="docutils literal"><span class="pre">xml::default</span> <span class="pre">val</span></tt>: an attribute with the given default value <tt class="docutils literal"><span class="pre">val</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xml::fixed</span> <span class="pre">val</span></tt>: an attribute with the given fixed value <tt class="docutils literal"><span class="pre">val</span></tt></li>
</ul>
</div>
</div>
<div class="section" id="operations">
<h2><a class="toc-backref" href="#id8">Operations</a><a class="headerlink" href="#operations" title="Permalink to this headline">¶</a></h2>
<p>This module provides all operations necessary to create, inspect and
manipulate XML documents residing either in memory or on disk. Operations
for formatting XML documents using XSLT stylesheets are also available.</p>
<div class="section" id="document-operations">
<h3><a class="toc-backref" href="#id9">Document Operations</a><a class="headerlink" href="#document-operations" title="Permalink to this headline">¶</a></h3>
<p>The following functions allow you to create new XML documents, load them
from or save them to a file or a string, and provide general information
about a document.</p>
<ul id="new-doc">
<span id="index-10"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::new_doc</span> <span class="pre">version</span> <span class="pre">dtd</span> <span class="pre">info</span></tt></p>
<p>This function creates an XML document. It returns a pointer to the new
document. <tt class="docutils literal"><span class="pre">version</span></tt> is a string denoting the XML version (or <tt class="docutils literal"><span class="pre">&quot;&quot;</span></tt> to
indicate the default). <tt class="docutils literal"><span class="pre">info</span></tt> is the <a class="reference internal" href="#node-info">node info</a> of the root node
(which should denote an element node). <tt class="docutils literal"><span class="pre">dtd</span></tt> denotes the document type
which can be <tt class="docutils literal"><span class="pre">()</span></tt> to denote an empty DTD, a string (the URI/filename of
the DTD), or a pair <tt class="docutils literal"><span class="pre">(pubid,sysid)</span></tt> where <tt class="docutils literal"><span class="pre">pubid</span></tt> denotes the public
identifier of the DTD and <tt class="docutils literal"><span class="pre">sysid</span></tt> its system identifier (URI).</p>
<p>Note that only simple kinds of documents with an internal DTD can be
created this way. Use the <a class="reference internal" href="#load-file">load_file</a> or <a class="reference internal" href="#load-string">load_string</a> function below to
create a skeleton document if a more elaborate prolog is required.</p>
</li>
</ul>
<span class="target" id="index-11"></span><ul id="load-string">
<span id="load-file"></span><span id="index-12"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::load_file</span> <span class="pre">name</span> <span class="pre">flags</span></tt>, <tt class="docutils literal"><span class="pre">xml::load_string</span> <span class="pre">s</span> <span class="pre">flags</span></tt></p>
<p>Load an XML document from a file <tt class="docutils literal"><span class="pre">name</span></tt> or a string <tt class="docutils literal"><span class="pre">s</span></tt>. <tt class="docutils literal"><span class="pre">flags</span></tt>
denotes the parser flags, a bitwise disjunction of any of the following
constants, or 0 for the default:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">xml::DTDLOAD</span></tt>: load DTD</li>
<li><tt class="docutils literal"><span class="pre">xml::DTDVALID</span></tt>: validate</li>
<li><tt class="docutils literal"><span class="pre">xml::PEDANTIC</span></tt>: pedantic parse</li>
<li><tt class="docutils literal"><span class="pre">xml::SUBENT</span></tt>: substitute entities</li>
<li><tt class="docutils literal"><span class="pre">xml::NOBLANKS</span></tt>: suppress blank nodes</li>
</ul>
<p>The return value is the document pointer. These operations may also fail
if there is a fatal error parsing the document.</p>
</li>
</ul>
<span class="target" id="index-13"></span><ul id="save-string">
<span id="save-file"></span><span id="index-14"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::save_file</span> <span class="pre">name</span> <span class="pre">doc</span> <span class="pre">encoding</span> <span class="pre">compression</span></tt>,
<tt class="docutils literal"><span class="pre">xml::save_string</span> <span class="pre">doc</span></tt></p>
<p>Save an XML document <tt class="docutils literal"><span class="pre">doc</span></tt> to a file or a string. When saving to a
file, <tt class="docutils literal"><span class="pre">encoding</span></tt> denotes the desired encoding (or <tt class="docutils literal"><span class="pre">&quot;&quot;</span></tt> for the
default), <tt class="docutils literal"><span class="pre">compression</span></tt> the desired level of zlib compression (0 means
none, 9 is maximum, -1 indicates the default). Note that with
<tt class="docutils literal"><span class="pre">xml::save_string</span></tt>, the result is always encoded as UTF-8.</p>
</li>
</ul>
<ul id="doc-info">
<span id="index-15"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::doc_info</span> <span class="pre">doc</span></tt></p>
<p>Retrieve general information about a document. Returns a tuple
<tt class="docutils literal"><span class="pre">(version,encoding,url,compression,standalone)</span></tt>, where <tt class="docutils literal"><span class="pre">version</span></tt> is
the XML version of the document, <tt class="docutils literal"><span class="pre">encoding</span></tt> the external encoding (if
any), <tt class="docutils literal"><span class="pre">url</span></tt> the name/location of the document (if any), <tt class="docutils literal"><span class="pre">compression</span></tt>
the level of zlib compression, and <tt class="docutils literal"><span class="pre">standalone</span></tt> is a flag indicating
whether the document contains any external markup declarations &#8220;which
affect the information passed from the XML processor to the application&#8221;,
see the section on the <a class="reference external" href="http://www.w3.org/TR/REC-xml/#sec-rmd">standalone document declaration</a> in the XML spec
for details. (Apparently, in libxml2 <tt class="docutils literal"><span class="pre">standalone</span></tt> is either a truth
value or one of the special values -1, indicating that there&#8217;s no XML
declaration in the prolog, or -2, indicating that there&#8217;s an XML
declaration but no <tt class="docutils literal"><span class="pre">standalone</span></tt> attribute.)</p>
</li>
</ul>
<span class="target" id="index-16"></span><ul id="ext-subset">
<span id="int-subset"></span><span id="index-17"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::int_subset</span> <span class="pre">doc</span></tt>, <tt class="docutils literal"><span class="pre">xml::ext_subset</span> <span class="pre">doc</span></tt></p>
<p>Retrieve the internal and external DTD subset of a document. Returns a
<tt class="docutils literal"><span class="pre">doctype</span></tt> node (fails if there&#8217;s no corresponding DTD).</p>
</li>
</ul>
<p><strong>Example</strong></p>
<p>Read the sample.xml document distributed with the sources (ignoring blank
nodes) and retrieve the document info:</p>
<div class="highlight-python"><pre>&gt; using xml;
&gt; let sample = xml::load_file "sample.xml" xml::NOBLANKS;
&gt; xml::doc_info sample;
"1.0","","sample.xml",0,-2</pre>
</div>
</div>
<div class="section" id="traversing-documents">
<h3><a class="toc-backref" href="#id10">Traversing Documents</a><a class="headerlink" href="#traversing-documents" title="Permalink to this headline">¶</a></h3>
<p>These operations are used to traverse the document tree, i.e., the nodes of
the document. They take either a document pointer <tt class="docutils literal"><span class="pre">doc</span></tt> or a node pointer
<tt class="docutils literal"><span class="pre">node</span></tt> as argument, and yield a corresponding node pointer (or a document
pointer, in the case of <tt class="docutils literal"><span class="pre">xml::doc</span></tt>). The node pointers can then be used
with the <a class="reference internal" href="#node-information">Node Information</a> and <a class="reference internal" href="#node-manipulation">Node Manipulation</a> operations described
below.</p>
<ul class="simple" id="root">
<span id="index-18"></span><li><tt class="docutils literal"><span class="pre">xml::root</span> <span class="pre">doc</span></tt>: the root node of <tt class="docutils literal"><span class="pre">doc</span></tt></li>
</ul>
<ul class="simple" id="doc">
<span id="index-19"></span><li><tt class="docutils literal"><span class="pre">xml::doc</span> <span class="pre">node</span></tt>: the document <tt class="docutils literal"><span class="pre">node</span></tt> belongs to</li>
</ul>
<ul class="simple" id="parent">
<span id="index-20"></span><li><tt class="docutils literal"><span class="pre">xml::parent</span> <span class="pre">node</span></tt>: the parent of <tt class="docutils literal"><span class="pre">node</span></tt></li>
</ul>
<span class="target" id="index-21"></span><ul class="simple" id="last-xml">
<span id="first-xml"></span><span id="index-22"></span><li><tt class="docutils literal"><span class="pre">xml::first</span> <span class="pre">node</span></tt>, <tt class="docutils literal"><span class="pre">xml::last</span> <span class="pre">node</span></tt>: first and last child node</li>
</ul>
<span class="target" id="index-23"></span><ul class="simple" id="prev">
<span id="next"></span><span id="index-24"></span><li><tt class="docutils literal"><span class="pre">xml::next</span> <span class="pre">node</span></tt>, <tt class="docutils literal"><span class="pre">xml::prev</span> <span class="pre">node</span></tt>: next and previous sibling</li>
</ul>
<span class="target" id="index-25"></span><ul class="simple" id="last-attr">
<span id="first-attr"></span><span id="index-26"></span><li><tt class="docutils literal"><span class="pre">xml::first_attr</span> <span class="pre">node</span></tt>, <tt class="docutils literal"><span class="pre">xml::last_attr</span> <span class="pre">node</span></tt>: first and last
attribute node</li>
</ul>
<p>All these operations fail if the corresponding target node does not exist,
or if the type of the given node is not supported by this implementation.</p>
<p>There are also two convenience functions to retrieve the children and
attribute nodes of a node:</p>
<ul class="simple" id="children">
<span id="index-27"></span><li><tt class="docutils literal"><span class="pre">xml::children</span> <span class="pre">node</span></tt>: returns the list of all child nodes of <tt class="docutils literal"><span class="pre">node</span></tt></li>
</ul>
<ul class="simple" id="attrs">
<span id="index-28"></span><li><tt class="docutils literal"><span class="pre">xml::attrs</span> <span class="pre">node</span></tt>: returns the list of all attribute nodes of <tt class="docutils literal"><span class="pre">node</span></tt></li>
</ul>
<p>Moreover, given a node pointer <tt class="docutils literal"><span class="pre">node</span></tt>, <tt class="docutils literal"><span class="pre">node!i</span></tt> can be used to retrieve
the <tt class="docutils literal"><span class="pre">i</span></tt>th child of <tt class="docutils literal"><span class="pre">node</span></tt>.</p>
<p><strong>Example</strong></p>
<p>Peek at the root node of the sample document and its children:</p>
<div class="highlight-python"><pre>&gt; let r = xml::root sample; r;
#&lt;pointer 0xe15e10&gt;
&gt; xml::node_info r;
xml::element "story" [] []
&gt; #xml::children r;
5
&gt; xml::node_info (r!0);
xml::cdata "&lt;greeting&gt;Hello, world!&lt;/greeting&gt;"</pre>
</div>
</div>
<div class="section" id="node-information">
<h3><a class="toc-backref" href="#id11">Node Information</a><a class="headerlink" href="#node-information" title="Permalink to this headline">¶</a></h3>
<p>These operations retrieve information about the nodes of an XML document.</p>
<ul id="select">
<span id="index-29"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::select</span> <span class="pre">doc</span> <span class="pre">xpath</span></tt>, <tt class="docutils literal"><span class="pre">xml::select</span> <span class="pre">doc</span> <span class="pre">(xpath,ns)</span></tt></p>
<p>Retrieve nodes using an <a class="reference external" href="http://www.w3.org/TR/xpath">XPath</a> specification. Given an XPath (a string)
<tt class="docutils literal"><span class="pre">xpath</span></tt>, this operation returns the list of all matching nodes in the
given document <tt class="docutils literal"><span class="pre">doc</span></tt>. You can also specify a node as the first
argument, in which case the document of the given node is searched and
paths are interpreted relative to the given node (rather than the root
node of the document).</p>
<p>Moreover, instead of just an XPath you can also specify a pair
<tt class="docutils literal"><span class="pre">(xpath,ns)</span></tt> consisting of an XPath <tt class="docutils literal"><span class="pre">xpath</span></tt> and a list <tt class="docutils literal"><span class="pre">ns</span></tt> of
<tt class="docutils literal"><span class="pre">prefix=&gt;uri</span></tt> string pairs which describe the namespaces to be
recognized in the XPath expression. This is necessary to select nodes by
qualified tag or attribute names. Note that only the namespace URIs must
match up with those used in the queried document; the corresponding
namespace prefixes can be chosen freely, so you can use whatever prefixes
are convenient to formulate the XPath query. However, for each namespace
prefix used in the XPath expression (not the document!), there <em>must</em> be
a corresponding binding in the <tt class="docutils literal"><span class="pre">ns</span></tt> list. Otherwise the underlying
libxml2 function will complain about an undefined namespace prefix and
<tt class="docutils literal"><span class="pre">xml::select</span></tt> will fail.</p>
</li>
</ul>
<ul id="id1">
<span id="index-30"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::node_info</span> <span class="pre">node</span></tt></p>
<p>Retrieve the node data from <tt class="docutils literal"><span class="pre">node</span></tt>. Returns a <a class="reference internal" href="#node-info">node info</a> value, as
described in <a class="reference internal" href="#data-structure">Data Structure</a> above. Fails if the node does not belong
to one of the supported node types.</p>
</li>
</ul>
<ul id="is-blank-node">
<span id="index-31"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::is_blank_node</span></tt></p>
<p>Checks whether a node is a blank node (empty or whitespace only) and thus
possibly ignorable.</p>
</li>
</ul>
<ul id="node-base">
<span id="index-32"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::node_base</span> <span class="pre">node</span></tt></p>
<p>Returns the base URI of the given node.</p>
</li>
</ul>
<ul id="node-path">
<span id="index-33"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::node_path</span> <span class="pre">node</span></tt></p>
<p>Returns the path of a node in the document, in the format accepted by
<a class="reference internal" href="#select">select</a>.</p>
</li>
</ul>
<ul id="node-content">
<span id="index-34"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::node_content</span> <span class="pre">node</span></tt></p>
<p>Returns the text carried by the node, if any (after entity substitution).</p>
</li>
</ul>
<p>In addition, you can retrieve and change attributes of element nodes with
the following operations:</p>
<ul id="node-attr">
<span id="index-35"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::node_attr</span> <span class="pre">node</span> <span class="pre">name</span></tt></p>
<p>Retrieves the value of the attribute with the given <tt class="docutils literal"><span class="pre">name</span></tt> (after
entity substitution).</p>
</li>
</ul>
<span class="target" id="index-36"></span><ul id="unset-node-attr">
<span id="set-node-attr"></span><span id="index-37"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::set_node_attr</span> <span class="pre">node</span> <span class="pre">name</span> <span class="pre">value</span></tt>, <tt class="docutils literal"><span class="pre">xml::unset_node_attr</span> <span class="pre">node</span> <span class="pre">name</span></tt></p>
<p>Sets or unsets an attribute value.</p>
</li>
</ul>
<p><strong>Examples</strong></p>
<p>Set and unset a node attribute:</p>
<div class="highlight-python"><pre>&gt; xml::set_node_attr r "foo" "4711";
()
&gt; xml::node_info r;
xml::element "story" [] ["foo"=&gt;"4711"]
&gt; xml::node_attr r "foo";
"4711"
&gt; xml::unset_node_attr r "foo";
()
&gt; xml::node_info r;
xml::element "story" [] []</pre>
</div>
<p>The <a class="reference internal" href="#select">select</a> function is <em>very</em> powerful, and probably the single most
important operation of this module if you want to extract information from
an existing XML document without traversing the entire structure. Here is a
very simple example of its use:</p>
<div class="highlight-python"><pre>&gt; [xml::node_content n, xml::node_path n | n = xml::select sample "//author"];
[("John Fleck","/story/storyinfo/author")]</pre>
</div>
<p>Note that if the XPath expression contains qualified names, the
corresponding namespace prefixes and their URIs must be given in the second
argument along with the XPath, as follows:</p>
<div class="highlight-python"><pre>xml::select doc ("//foo:bar", ["foo"=&gt;"http://www.foo.org"]);</pre>
</div>
</div>
<div class="section" id="node-manipulation">
<h3><a class="toc-backref" href="#id12">Node Manipulation</a><a class="headerlink" href="#node-manipulation" title="Permalink to this headline">¶</a></h3>
<p>These operations enable you to manipulate the document structure by adding
a new node to the document tree (specified through its <a class="reference internal" href="#node-info">node info</a>), and
by removing (unlinking) existing nodes from the tree.</p>
<ul id="replace">
<span id="index-38"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::replace</span> <span class="pre">node</span> <span class="pre">info</span></tt></p>
<p>Add the new node specified by <tt class="docutils literal"><span class="pre">info</span></tt> in place of the given node
<tt class="docutils literal"><span class="pre">node</span></tt>.</p>
</li>
</ul>
<span class="target" id="index-39"></span><ul id="add-last">
<span id="add-first"></span><span id="index-40"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::add_first</span> <span class="pre">node</span> <span class="pre">info</span></tt>, <tt class="docutils literal"><span class="pre">xml::add_last</span> <span class="pre">node</span> <span class="pre">info</span></tt></p>
<p>Add the new node as the first or last child of <tt class="docutils literal"><span class="pre">node</span></tt>, respectively.</p>
</li>
</ul>
<span class="target" id="index-41"></span><ul id="add-prev">
<span id="add-next"></span><span id="index-42"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::add_next</span> <span class="pre">node</span> <span class="pre">info</span></tt>, <tt class="docutils literal"><span class="pre">xml::add_prev</span> <span class="pre">node</span> <span class="pre">info</span></tt></p>
<p>Add the new node as the next or previous sibling of <tt class="docutils literal"><span class="pre">node</span></tt>,
respectively.</p>
</li>
</ul>
<p>The operations above all return a pointer to the new XML node object.</p>
<ul id="unlink">
<span id="index-43"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xml::unlink</span> <span class="pre">node</span></tt></p>
<p>Deletes an existing node from the document tree. Returns <tt class="docutils literal"><span class="pre">()</span></tt>.</p>
</li>
</ul>
<p><strong>Examples</strong></p>
<p>Replace the first child of the root node in the sample document:</p>
<div class="highlight-python"><pre>&gt; xml::node_info (r!0);
xml::cdata "&lt;greeting&gt;Hello, world!&lt;/greeting&gt;"
&gt; xml::replace (r!0) (xml::text "bla bla");
#&lt;pointer 0xd40d80&gt;
&gt; xml::node_info (r!0);
xml::text "bla bla"</pre>
</div>
<p>Delete that node:</p>
<div class="highlight-python"><pre>&gt; xml::unlink (r!0);
()
&gt; xml::node_info (r!0);
xml::comment "This is a sample document for testing the xml interface."</pre>
</div>
</div>
<div class="section" id="transformations">
<h3><a class="toc-backref" href="#id13">Transformations</a><a class="headerlink" href="#transformations" title="Permalink to this headline">¶</a></h3>
<p>The following operations provide basic XSLT support. As already mentioned,
stylesheets are represented as pointers to the xsltStylesheet structure
provided by libxslt. Note that, in difference to XML document pointers,
this is an opaque type, i.e., there is no direct means to inspect and
manipulate parsed stylesheets in memory using the operations of this
module. However, a stylesheet is just a special kind of XML document and
thus can be manipulated after reading the stylesheet as an ordinary XML
document. The <a class="reference internal" href="#load-stylesheet">load_stylesheet</a> function then allows you to convert the
document pointer to an XSLT Stylesheet object.</p>
<p>Applying a stylesheet to an XML document generally involves the following
steps:</p>
<ol class="arabic simple">
<li>Load and parse the stylesheet using <a class="reference internal" href="#load-stylesheet">load_stylesheet</a>. The parameter to
<a class="reference internal" href="#load-stylesheet">load_stylesheet</a> can be either the name of a stylesheet file or a
corresponding document pointer. The function returns a pointer to the
stylesheet object which is used in the subsequent processing.</li>
<li>Invoke <a class="reference internal" href="#apply-stylesheet">apply_stylesheet</a> on the stylesheet and the target document.
This returns a new document containing the transformed XML document.</li>
<li>Run <a class="reference internal" href="#save-result-file">save_result_file</a> or <a class="reference internal" href="#save-result-string">save_result_string</a> on the result and the
stylesheet to save the transformed document in a file or a string.</li>
</ol>
<p>Here is a brief summary of the XSLT operations. Please check the <a class="reference external" href="http://www.w3.org/TR/xslt">XSLT</a>
documentation for details of the transformation process.</p>
<ul id="load-stylesheet">
<span id="index-44"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xslt::load_stylesheet</span> <span class="pre">x</span></tt></p>
<p>Load a stylesheet. <tt class="docutils literal"><span class="pre">x</span></tt> can be either an XML document pointer, or a
string denoting the desired <tt class="docutils literal"><span class="pre">.xsl</span></tt> file.</p>
</li>
</ul>
<ul id="apply-stylesheet">
<span id="index-45"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xslt::apply_stylesheet</span> <span class="pre">style</span> <span class="pre">doc</span> <span class="pre">params</span></tt></p>
<p>Apply the stylesheet <tt class="docutils literal"><span class="pre">style</span></tt> to the given document <tt class="docutils literal"><span class="pre">doc</span></tt> with the
given parameters <tt class="docutils literal"><span class="pre">params</span></tt>. The third argument is a (possibly empty)
list of <tt class="docutils literal"><span class="pre">key=&gt;value</span></tt> string pairs which allows you to pass additional
parameters to the stylesheet.</p>
</li>
</ul>
<span class="target" id="index-46"></span><ul id="save-result-string">
<span id="save-result-file"></span><span id="index-47"></span><li><p class="first"><tt class="docutils literal"><span class="pre">xslt::save_result_file</span> <span class="pre">name</span> <span class="pre">doc</span> <span class="pre">style</span> <span class="pre">compression</span></tt>,
<tt class="docutils literal"><span class="pre">xslt::save_result_string</span> <span class="pre">doc</span> <span class="pre">style</span></tt></p>
<p>Save the transformation result <tt class="docutils literal"><span class="pre">doc</span></tt> obtained with the stylesheet
<tt class="docutils literal"><span class="pre">style</span></tt> to a file or a string. This works pretty much like <a class="reference internal" href="#save-file">save_file</a>
or <a class="reference internal" href="#save-string">save_string</a>, but also keeps track of some output-related information
contained in the stylesheet.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<p>Load the recipes.xml document and the recipes.xsl stylesheet distributed
with the sources:</p>
<div class="highlight-python"><pre>&gt; let recipes = xml::load_file "recipes.xml" xml::DTDVALID;
&gt; let style = xslt::load_stylesheet "recipes.xsl";</pre>
</div>
<p>Apply the stylesheet to the document and save the result in a html file:</p>
<div class="highlight-python"><pre>&gt; let res = xslt::apply_stylesheet style recipes [];
&gt; xslt::save_result_file "recipes.html" res style 0;
()</pre>
</div>
<p>That&#8217;s all. You can now have a look at recipes.html in your favourite web
browser.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="puredoc.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Pure-XML - XML/XSLT interface</a><ul>
<li><a class="reference internal" href="#copying">Copying</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
<li><a class="reference internal" href="#data-structure">Data Structure</a><ul>
<li><a class="reference internal" href="#the-document-tree">The Document Tree</a></li>
<li><a class="reference internal" href="#document-types">Document Types</a></li>
</ul>
</li>
<li><a class="reference internal" href="#operations">Operations</a><ul>
<li><a class="reference internal" href="#document-operations">Document Operations</a></li>
<li><a class="reference internal" href="#traversing-documents">Traversing Documents</a></li>
<li><a class="reference internal" href="#node-information">Node Information</a></li>
<li><a class="reference internal" href="#node-manipulation">Node Manipulation</a></li>
<li><a class="reference internal" href="#transformations">Transformations</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pure-sql3.html"
                        title="previous chapter">Pure-Sql3</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pure-g2.html"
                        title="next chapter">pure-g2</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/pure-xml.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="pure-g2.html" title="pure-g2"
             >next</a> |</li>
        <li class="right" >
          <a href="pure-sql3.html" title="Pure-Sql3"
             >previous</a> |</li>
        <li><a href="puredoc.html">Pure Language and Library Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Albert Gräf, Kay-Uwe Kirstein, Eddie Rucker, Jiri Spitz, Peter Summerland.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1pre.
    </div>
  </body>
</html>