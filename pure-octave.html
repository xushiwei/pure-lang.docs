

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pure-octave &mdash; Pure Language and Library Documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="top" title="Pure Language and Library Documentation" href="index.html" />
    <link rel="next" title="Pure-Rational - Rational number library for the Pure programming language" href="pure-rational.html" />
    <link rel="prev" title="pure-gsl - GNU Scientific Library Interface for Pure" href="pure-gsl.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="pure-rational.html" title="Pure-Rational - Rational number library for the Pure programming language"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pure-gsl.html" title="pure-gsl - GNU Scientific Library Interface for Pure"
             accesskey="P">previous</a> |</li>
        <li><a href="puredoc.html">Pure Language and Library Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="pure-octave">
<h1>pure-octave<a class="headerlink" href="#pure-octave" title="Permalink to this headline">¶</a></h1>
<p>Version 0.1, November 10, 2010</p>
<p>Albert Graef &lt;<a class="reference external" href="mailto:Dr&#46;Graef&#37;&#52;&#48;t-online&#46;de">Dr<span>&#46;</span>Graef<span>&#64;</span>t-online<span>&#46;</span>de</a>&gt;</p>
<p>A Pure interface to <a class="reference external" href="http://www.octave.org">GNU Octave</a>.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#copying" id="id2">Copying</a></li>
<li><a class="reference internal" href="#installation" id="id3">Installation</a></li>
<li><a class="reference internal" href="#basic-usage" id="id4">Basic Usage</a></li>
<li><a class="reference internal" href="#direct-function-calls" id="id5">Direct Function Calls</a></li>
<li><a class="reference internal" href="#data-conversions" id="id6">Data Conversions</a></li>
<li><a class="reference internal" href="#calling-back-into-pure" id="id7">Calling Back Into Pure</a></li>
<li><a class="reference internal" href="#caveats-and-notes" id="id8">Caveats and Notes</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This is an Octave module for the Pure programming language, based on Paul
Kienzle&#8217;s <a class="reference external" href="http://wiki.octave.org/wiki.pl?OctaveEmbedded">octave_embed</a> which allows Octave to be embedded in other languages.
It allows you to execute arbitrary Octave commands and Octave functions from
Pure.</p>
</div>
<div class="section" id="copying">
<h2><a class="toc-backref" href="#id2">Copying</a><a class="headerlink" href="#copying" title="Permalink to this headline">¶</a></h2>
<p>pure-octave is free software: you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.</p>
<p>pure-octave is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
A PARTICULAR PURPOSE.</p>
<p>Please see the accompanying COPYING file for the precise license terms. The
GPL can also be read online at <a class="reference external" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
</div>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id3">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Get the latest source from
<a class="reference external" href="http://pure-lang.googlecode.com/files/pure-octave-0.1.tar.gz">http://pure-lang.googlecode.com/files/pure-octave-0.1.tar.gz</a>.</p>
<p>Run <tt class="docutils literal"><span class="pre">make</span></tt> to compile the module and <tt class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></tt> (as root) to install
it in the Pure library directory. This requires GNU make, and of course you
need to have both Pure and Octave installed (including Octave&#8217;s <tt class="docutils literal"><span class="pre">mkoctfile</span></tt>
utility and the corresponding header files and libraries).</p>
<p><tt class="docutils literal"><span class="pre">make</span></tt> tries to guess your Pure installation directory and platform-specific
setup. If it gets this wrong, you can set some variables manually. In
particular, <tt class="docutils literal"><span class="pre">make</span> <span class="pre">install</span> <span class="pre">prefix=/usr</span></tt> sets the installation prefix. Please
see the Makefile for details.</p>
<p>NOTE: This release of pure-gen has been tested with Octave 3.2.4. Older
versions might require some fiddling with the sources to get the embedded
Octave interface working.</p>
</div>
<div class="section" id="basic-usage">
<h2><a class="toc-backref" href="#id4">Basic Usage</a><a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>Import this module into your Pure scripts as follows:</p>
<div class="highlight-python"><pre>using octave;</pre>
</div>
<p>This will add an embedded instance of the Octave interpreter to your program.
(You can import this module as often as you want, but there&#8217;s always only one
instance of Octave in each process.)</p>
<p>Arbitrary Octave code can be executed with the <tt class="docutils literal"><span class="pre">octave_eval</span></tt> function:</p>
<div class="highlight-python"><pre>&gt; octave_eval "eig([1 2;3 4])";
ans =

  -0.37228
   5.37228

0</pre>
</div>
<p>This prints the result on stdout and returns a result code (zero if everything
went fine). To suppress the printing of the result, simply terminate the
Octave statement with a semicolon:</p>
<div class="highlight-python"><pre>&gt; octave_eval "eig([1 2;3 4]);";
0</pre>
</div>
<p>You can also set and get global variables in the Octave interpreter. This
allows you to define values to be used when evaluating Octave code, and to
transfer results back to Pure. However, before such globals can be accessed in
Octave, you must explicitly declare them as globals:</p>
<div class="highlight-python"><pre>&gt; octave_eval "global x y ans";
0</pre>
</div>
<p>Now you can use <tt class="docutils literal"><span class="pre">octave_set</span></tt> and <tt class="docutils literal"><span class="pre">octave_get</span></tt> to transfer values between
Pure and Octave as follows:</p>
<div class="highlight-python"><pre>&gt; octave_set "x" {1.0,2.0;3.0,4.0};
{1.0,2.0;3.0,4.0}
&gt; octave_eval "eig(x);";
0
&gt; octave_get "ans";
{-0.372281323269014;5.37228132326901}</pre>
</div>
<p>Note that the most recent result can always be accessed through Octave&#8217;s
<tt class="docutils literal"><span class="pre">ans</span></tt> variable. You can also use an explicit variable definition as
follows:</p>
<div class="highlight-python"><pre>&gt; octave_eval "y = eig(x);";
0
&gt; octave_get "y";
{-0.372281323269014;5.37228132326901}</pre>
</div>
</div>
<div class="section" id="direct-function-calls">
<h2><a class="toc-backref" href="#id5">Direct Function Calls</a><a class="headerlink" href="#direct-function-calls" title="Permalink to this headline">¶</a></h2>
<p>Octave functions can also be called in a direct fashion with the
<tt class="docutils literal"><span class="pre">octave_call</span></tt> function, which gets invoked with the name of the function,
the number of function results and the function arguments:</p>
<div class="highlight-python"><pre>&gt; let x = {1.0,2.0;3.0,4.0};
&gt; octave_call "eig" 1 x;
{-0.372281323269014;5.37228132326901}</pre>
</div>
<p>Note the second argument, which denotes the desired number of <em>return</em>
values. This will usually be 1 (or 0 if you don&#8217;t care about the result), but
some Octave functions may return a variable number of results, depending on
how they&#8217;re called. Multiple values are returned as tuples in Pure:</p>
<div class="highlight-python"><pre>&gt; octave_call "eig" 2 x;
{-0.824564840132394,-0.415973557919284;0.565767464968992,-0.909376709132124},
{-0.372281323269014,0.0;0.0,5.37228132326901}</pre>
</div>
<p>If there are multiple <em>arguments</em>, you can specify them either as a tuple or a
list:</p>
<div class="highlight-python"><pre>&gt; octave_call "norm" 1 (x, 2);
5.46498570421904
&gt; octave_call "norm" 1 [x, 1];
6.0</pre>
</div>
<p>Instead of a function name, you can also specify the function to be called
using a special kind of Octave object, a function value. These are returned,
e.g., by Octave&#8217;s <tt class="docutils literal"><span class="pre">str2func</span></tt> and <tt class="docutils literal"><span class="pre">inline</span></tt> builtins. For your convenience,
pure-octave provides a frontend to these builtins, the <tt class="docutils literal"><span class="pre">octave_func</span></tt>
function, which lets you specify an Octave function in one of two ways:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">octave_func</span> <span class="pre">name</span></tt>, where <tt class="docutils literal"><span class="pre">name</span></tt> is the function name as a string,
returns the Octave function with the given name. This works like Octave&#8217;s
<tt class="docutils literal"><span class="pre">str2func</span></tt> builtin.</li>
<li><tt class="docutils literal"><span class="pre">octave_func</span> <span class="pre">expr</span></tt>, where <tt class="docutils literal"><span class="pre">expr</span></tt> is an Octave expression (as a string)
describing the function value, returns an &#8220;inline&#8221; function. This works like
Octave&#8217;s <tt class="docutils literal"><span class="pre">inline</span></tt> builtin. Instead of just an Octave expression, you can
also specify a tuple or a list consisting of the inline expression and the
parameter names. (Otherwise the parameters are determined automatically, see
the description of the <tt class="docutils literal"><span class="pre">inline</span></tt> function in the Octave manual for
details.)</li>
</ul>
<p>Note that inline functions allow you to call stuff that is not an Octave
function and hence cannot be specified directly in <tt class="docutils literal"><span class="pre">octave_call</span></tt>, such as an
operator. Examples:</p>
<div class="highlight-python"><pre>&gt; let eig = octave_func "eig";
&gt; let mul = octave_func "x*y";
&gt; octave_call eig 1 (octave_call mul 1 (x,x));
{0.138593383654928;28.8614066163451}
&gt; let add = octave_func ("x+y","x","y");
&gt; octave_call add 1 (x,x);
{2.0,4.0;6.0,8.0}</pre>
</div>
</div>
<div class="section" id="data-conversions">
<h2><a class="toc-backref" href="#id6">Data Conversions</a><a class="headerlink" href="#data-conversions" title="Permalink to this headline">¶</a></h2>
<p>As shown above, the <tt class="docutils literal"><span class="pre">octave_set</span></tt>, <tt class="docutils literal"><span class="pre">octave_get</span></tt> and <tt class="docutils literal"><span class="pre">octave_call</span></tt>
functions convert Pure data to corresponding Octave values and vice versa.
Octave scalars and matrices of boolean, integer, double, complex and character
data are all supported by this interface, and are mapped to the corresponding
Pure data types in a straightforward manner (scalars to scalars, matrices to
matrices and strings to strings). Note that in any case these conversions
create <em>copies</em> of the data, so modifying, say, an Octave matrix received via
<tt class="docutils literal"><span class="pre">octave_get</span></tt> in Pure only affects the Pure copy of the matrix and leaves the
original Octave matrix unchanged.</p>
<p>Any other kind of Octave object (including Octave function objects, see
<a class="reference internal" href="#direct-function-calls">Direct Function Calls</a>) is just passed through as is, in the form of a
cooked pointer to an Octave value which frees itself when garbage-collected.
You can check for such objects with the <tt class="docutils literal"><span class="pre">octave_valuep</span></tt> predicate:</p>
<div class="highlight-python"><pre>&gt; let eig = octave_func "eig";
&gt; eig; octave_valuep eig;
#&lt;pointer 0x230dba0&gt;
1</pre>
</div>
<p>Such Octave value pointers can be used freely whereever an Octave value is
needed (i.e., in invocations of <tt class="docutils literal"><span class="pre">octave_set</span></tt> and <tt class="docutils literal"><span class="pre">octave_call</span></tt>).</p>
<p>You should also note the following:</p>
<ul>
<li><p class="first">Octave&#8217;s cell arrays and structures are not supported at this time, so they
will show up as opaque Octave value pointers in Pure land. This allows these
objects to be passed around freely, but you can&#8217;t inspect or modify them in
Pure.</p>
</li>
<li><p class="first">Scalars and 1x1 matrices are indistinguishable in Octave, thus any 1x1
matrix will be returned as a scalar from Octave to Pure.</p>
</li>
<li><p class="first">All types of boolean and integer matrices are returned from Octave to Pure
as (machine) integer matrices. When converted back to Octave, these all
become Octave <tt class="docutils literal"><span class="pre">int32</span></tt> matrices, but you can easily convert them to boolean
or other types of matrices in Octave as needed. For instance:</p>
<div class="highlight-python"><pre>&gt; octave_set "a" {1,2;3,4};
{1,2;3,4}
&gt; octave_eval "global a ans";
0
&gt; octave_eval "eig(a)";
error: eig: wrong type argument `int32 matrix'
1
&gt; octave_eval "eig(double(a))";
ans =

  -0.37228
   5.37228

0
&gt; octave_eval "a&gt;2";
ans =

   0   0
   1   1

0
&gt; octave_get "ans";
{0,0;1,1}</pre>
</div>
</li>
<li><p class="first">Octave strings are mapped to Pure strings, and character matrices with more
than one row are mapped to (symbolic) column vectors of Pure strings.
Example:</p>
<div class="highlight-python"><pre>&gt; octave_set "a" "Hello, world!";
"Hello, world!"
&gt; octave_eval "a";
a = Hello, world!
0
&gt; octave_eval "[a;'abc']";
ans =

Hello, world!
abc

0
&gt; octave_get "ans";
{"Hello, world!";"abc          "}</pre>
</div>
</li>
</ul>
</div>
<div class="section" id="calling-back-into-pure">
<h2><a class="toc-backref" href="#id7">Calling Back Into Pure</a><a class="headerlink" href="#calling-back-into-pure" title="Permalink to this headline">¶</a></h2>
<p>The embedded Octave interpreter provides one special builtin, the
<tt class="docutils literal"><span class="pre">pure_call</span></tt> function which can be used to call any function defined in the
executing Pure script from Octave. For instance:</p>
<div class="highlight-python"><pre>&gt; even m::matrix = {~(int x mod 2) | x=m};
&gt; octave_eval "pure_call('even', 1:12)";
ans =

  0  1  0  1  0  1  0  1  0  1  0  1

0</pre>
</div>
<p>Here&#8217;s the description of the <tt class="docutils literal"><span class="pre">pure_call</span></tt> function, as it is printed with
Octave&#8217;s <tt class="docutils literal"><span class="pre">help</span></tt> command:</p>
<div class="highlight-python"><pre>`pure_call' is a built-in function

  RES = pure_call(NAME, ARG, ...)
  [RES, ...] = pure_call(NAME, ARG, ...)

  Execute the Pure function named NAME (a string) with the given arguments.
  Arguments and result types may be scalars and matrices of boolean, integer,
  double, complex and character data. The Pure function may return multiple
  results as a tuple. Example: pure('succ', 99) =&gt; 100.</pre>
</div>
</div>
<div class="section" id="caveats-and-notes">
<h2><a class="toc-backref" href="#id8">Caveats and Notes</a><a class="headerlink" href="#caveats-and-notes" title="Permalink to this headline">¶</a></h2>
<p>Directly embedding Octave in Pure programs is convenient because it allows
easy exchange of data between Pure and Octave, and you can also call Octave
functions directly from Pure and vice versa. However, it also comes at a
cost. A default build of Octave pulls in quite a few dependencies of its own
which might conflict with other modules loaded in a Pure script. Specifically,
we have found that building Octave with native graphics support (as is
included in the latest Octave versions) may give problems with third-party
graphics libraries such as <a class="reference external" href="http://www.vtk.org/">VTK</a> (which segfaults, apparently due to FreeType
library compatibility issues, if used in the same program as Octave).</p>
<p>We&#8217;re not sure whether Octave or VTK is to blame here, but until these quirks
get ironed out you can work around them by disabling native graphics support
in Octave. Unfortunately, Octave currently doesn&#8217;t provide an option to do so,
but the following patches available at the Pure website will do the trick
(there are different versions of the patch, corresponding to the current
stable and development versions of Octave):</p>
<ul class="simple">
<li>Octave 3.2.4: <a class="reference external" href="http://pure-lang.googlecode.com/svn/wiki/octave-3.2.4.patch">http://pure-lang.googlecode.com/svn/wiki/octave-3.2.4.patch</a></li>
<li>Octave 3.3.51: <a class="reference external" href="http://pure-lang.googlecode.com/svn/wiki/octave-3.3.51.patch">http://pure-lang.googlecode.com/svn/wiki/octave-3.3.51.patch</a></li>
</ul>
<p>The patch is to be applied to Octave&#8217;s configure.in (configure.ac for the
latest development versions) by running a command like the following in the
Octave source directory:</p>
<div class="highlight-python"><pre>patch -p0 &lt; octave-3.2.4.patch</pre>
</div>
<p>Then just rerun <tt class="docutils literal"><span class="pre">autoconf</span></tt> and <tt class="docutils literal"><span class="pre">configure</span></tt> and compile Octave as usual.
The resulting version of Octave will have native graphics disabled and should
work ok with third party libraries such as VTK.</p>
<p>(If you have an Octave version which differs considerably from what we provide
here then you may have to rework the patch accordingly or apply the necessary
changes to configure.in or configure.ac manually.)</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="puredoc.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">pure-octave</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#copying">Copying</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
<li><a class="reference internal" href="#direct-function-calls">Direct Function Calls</a></li>
<li><a class="reference internal" href="#data-conversions">Data Conversions</a></li>
<li><a class="reference internal" href="#calling-back-into-pure">Calling Back Into Pure</a></li>
<li><a class="reference internal" href="#caveats-and-notes">Caveats and Notes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pure-gsl.html"
                        title="previous chapter">pure-gsl - GNU Scientific Library Interface for Pure</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pure-rational.html"
                        title="next chapter">Pure-Rational - Rational number library for the Pure programming language</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/pure-octave.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="pure-rational.html" title="Pure-Rational - Rational number library for the Pure programming language"
             >next</a> |</li>
        <li class="right" >
          <a href="pure-gsl.html" title="pure-gsl - GNU Scientific Library Interface for Pure"
             >previous</a> |</li>
        <li><a href="puredoc.html">Pure Language and Library Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Albert Gräf, Kay-Uwe Kirstein, Eddie Rucker, Jiri Spitz, Peter Summerland.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1pre.
    </div>
  </body>
</html>